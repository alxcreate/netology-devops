# Домашнее задание к занятию "Обновление приложений"

### Цель задания

Выбрать и настроить стратегию обновления приложения.

### Чеклист готовности к домашнему заданию

1. Кластер k8s.

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. [Документация Updating a Deployment](https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment)
2. [Статья про стратегии обновлений](https://habr.com/ru/companies/flant/articles/471620/)

-----

### Задание 1. Выбрать стратегию обновления приложения и описать ваш выбор.

1. Имеется приложение, состоящее из нескольких реплик, которое требуется обновить.
2. Ресурсы, выделенные для приложения ограничены, и нет возможности их увеличить.
3. Запас по ресурсам в менее загруженный момент времени составляет 20%.
4. Обновление мажорное, новые версии приложения не умеют работать со старыми.
5. Какую стратегию обновления выберете и почему?

### Ответ

При выборе стратегии обновления приложения с учетом ограниченных ресурсов и требования к мажорному обновлению, я рекомендую использовать стратегию "Rolling Update" (последовательного обновления).

Стратегия Rolling Update позволяет постепенно обновлять приложение, заменяя старые реплики новыми, одновременно поддерживая доступность приложения для пользователей. В данной стратегии новые версии приложения запускаются постепенно, по одной реплике за раз, и только после успешного запуска каждой реплики происходит остановка соответствующей старой реплики.

Основные причины выбора стратегии Rolling Update в данном случае:

1. Ограниченные ресурсы: Поскольку ресурсы, выделенные для приложения, ограничены, стратегия Rolling Update позволяет контролировать использование ресурсов и уменьшает риск перегрузки инфраструктуры. Постепенное обновление по одной реплике помогает снизить общую нагрузку на инфраструктуру и обеспечить стабильную работу приложения в условиях ограниченных ресурсов.

2. Запас по ресурсам: Зная, что в менее загруженный момент времени имеется запас ресурсов в размере 20%, стратегия Rolling Update идеально подходит, поскольку она позволяет постепенно заменять реплики, используя этот запас. После успешного запуска каждой новой реплики, можно остановить соответствующую старую реплику и освободить ресурсы для запуска следующей новой реплики.

3. Мажорное обновление: Учитывая, что новые версии приложения не умеют работать со старыми, стратегия Rolling Update позволяет безопасно обновить каждую реплику по очереди. Это уменьшает риск возникновения проблем совместимости и позволяет быстро выявить и устранить возможные проблемы при обновлении.

В итоге, выбор стратегии Rolling Update позволяет сбалансировать использование ресурсов, обновить приложение мажорным образом и поддерживать его доступность для пользователей на протяжении всего процесса обновления.

### Задание 2. Обновить приложение.

1. Создать deployment приложения с контейнерами nginx и multitool. Версию nginx взять 1.19. Кол-во реплик - 5.
2. Обновить версию nginx в приложении до версии 1.20, сократив время обновления до минимума. Приложение должно быть доступно.
3. Попытаться обновить nginx до версии 1.28, приложение должно оставаться доступным.
4. Откатиться после неудачного обновления.

### Ответ

## Дополнительные задания (со звездочкой*)

**Настоятельно рекомендуем выполнять все задания под звёздочкой.**   Их выполнение поможет глубже разобраться в материале.
Задания под звёздочкой дополнительные (необязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию.

### Задание 3*. Создать Canary deployment.

1. Создать 2 deployment'а приложения nginx.
2. При помощи разных ConfigMap сделать 2 версии приложения (веб-страницы).
3. С помощью ingress создать канареечный деплоймент, чтобы можно было часть трафика перебросить на разные версии приложения.

### Правила приема работы

1. Домашняя работа оформляется в своем Git репозитории в файле README.md. Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.
2. Файл README.md должен содержать скриншоты вывода необходимых команд, а также скриншоты результатов
3. Репозиторий должен содержать тексты манифестов или ссылки на них в файле README.md
